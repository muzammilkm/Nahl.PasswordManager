!function(e){e("core.cryptoService",new class{AuthPasswordSaltByteSize=16;PasswordSaltByteSize=16;NonceSaltByteSize=12;TagByteSize=16;SignatureByteSize=32;PasswordIterationCount=1e5;CipherTextStructure=[this.AuthPasswordSaltByteSize,this.AuthPasswordSaltByteSize+this.PasswordSaltByteSize,this.AuthPasswordSaltByteSize+this.PasswordSaltByteSize+this.NonceSaltByteSize];MinimumEncryptedMessageByteSize=this.AuthPasswordSaltByteSize+this.PasswordSaltByteSize+this.NonceSaltByteSize+0+this.TagByteSize+this.SignatureByteSize;enc=new TextEncoder;dec=new TextDecoder;bytesToBase64=e=>btoa(String.fromCharCode.apply(null,e));base64Bytes=e=>Uint8Array.from(atob(e),e=>e.charCodeAt(null));getPasswordKey=e=>window.crypto.subtle.importKey("raw",this.enc.encode(e),{name:"PBKDF2"},!1,["deriveKey"]);deriveKey=(e,t,s,i)=>window.crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:this.PasswordIterationCount,hash:"SHA-256"},e,s,!1,i);generateRandomBytes=e=>window.crypto.getRandomValues(new Uint8Array(e));encrypt=async(e,t)=>{var s=this.generateRandomBytes(this.AuthPasswordSaltByteSize),i=this.generateRandomBytes(this.PasswordSaltByteSize),a=this.generateRandomBytes(this.NonceSaltByteSize),t=await this.getPasswordKey(t),r=await this.deriveKey(t,i,{name:"AES-GCM",length:256},["encrypt"]),r=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:a},r,e),e=new Uint8Array(r),r=new Uint8Array([...s,...i,...a,...e]),i=await this.deriveKey(t,s,{name:"HMAC",hash:{name:"SHA-256"},length:256},["sign"]),a=await window.crypto.subtle.sign({name:"HMAC"},i,r);return new Uint8Array([...r,...new Uint8Array(a)])};encode=e=>this.enc.encode(e);decrypt=async(e,t)=>{const s=e.subarray(0,e.length-this.SignatureByteSize);var i=s.subarray(0,this.CipherTextStructure[0]),a=s.subarray(this.CipherTextStructure[0],this.CipherTextStructure[1]),r=s.subarray(this.CipherTextStructure[1],this.CipherTextStructure[2]),o=s.subarray(this.CipherTextStructure[2]),e=e.subarray(s.length),t=await this.getPasswordKey(t),i=await this.deriveKey(t,i,{name:"HMAC",hash:{name:"SHA-256"},length:256},["sign","verify"]);if(!await window.crypto.subtle.verify({name:"HMAC"},i,e,s))throw"Password validation failed.";i=await this.deriveKey(t,a,{name:"AES-GCM",length:256},["encrypt","decrypt"]),e=await crypto.subtle.decrypt({name:"AES-GCM",iv:r},i,o);return new Uint8Array(e)};decode=e=>this.dec.decode(e)})}($resolver),function(r){$resolver("manager.passwordDetail",function(t,a){var e={init:function(){var e=this;return e.additionalDetailList=r("#additional-detail-list tbody"),e.noRowMessageTml=_.template(r("#no-row-message-tml").html()),e.additionalDetailRowTml=_.template(r("#additional-detail-row-tml").html()),e},render:function(){var s=this,i="",e=t.getSelectedPasswordAdditionalDetails();return 0===e.length?i="<tr class='no-data'><td colspan='4'>"+s.noRowMessageTml()+"</td></tr>":e.forEach((e,t)=>{i+=s.additionalDetailRowTml({...e,index:t})}),s.additionalDetailList.html(i),r(".delete-password-additional-detail").click(e=>{e=r(e.target).closest("tr");a.removePasswordAdditionalDetail(e.data("index"))}),s},get:function(){var s=[];return this.additionalDetailList.children("tr").each((e,t)=>{t=r(t);t.hasClass("no-data")||s.push({key:t.find(".key").val(),value:t.find(".value").val()})}),s}};return e.init()})}(jQuery),function(i){$resolver("manager.passwordDetailGridOperation",function(e,t){var s={init:function(){return i("#add-password").click(e=>t.showAddPassword()),i("#upload-passwords").click(e=>t.showSecretModal("upload")),i("#save-passwords").click(e=>t.showSecretModal("download")),i("#search-passwords").click(e=>t.searchPasswords(i("#search-passwords-in").val(),i("#txt-search-password").val())),i("#txt-search-password").keyup(e=>t.searchPasswords(i("#search-passwords-in").val(),i("#txt-search-password").val())),this},render:function(){return i("#save-passwords span").toggleClass("d-none",!e.isDirty()),this}};return s.init()})}(jQuery),function(o){$resolver("manager.passwordDetailGrid",function(a,r){var e={init:function(){var e=this;return e.lblPasswordCount=o("#lbl-password-count"),e.passwordDetailList=o("#password-detail-list .body"),e.noRowMessageTml=_.template(o("#no-row-message-tml").html()),e.passwordRowTml=_.template(o("#password-row-tml").html()),e.paginationItemTml=_.template(o("#pagination-item-tml").html()),e},render:function(){var s=this,i="",e=a.getPasswordListSource(),t=a.getPasswordList();return 0===t.length?i=s.noRowMessageTml():t.forEach((e,t)=>{i+=s.passwordRowTml({...e,index:t})}),s.lblPasswordCount.text(`Showing ${t.length} of ${e.length} passwords.`),s.passwordDetailList.html(i),o(".edit-password").click(e=>{e=o(e.target).closest(".row");r.showEditPassword(e.data("index"))}),o(".delete-password").click(e=>{e=o(e.target).closest(".row");r.deletePassword(e.data("index"))}),o(".expand-password").click(e=>{e=o(e.target);e.children("i").toggleClass("fa-angle-down fa-angle-up"),e.closest(".row").next().children().each((e,t)=>{new bootstrap.Collapse(t)})}),o(".toggle-password").click(e=>{e=o(e.target).closest("div");e.find("i").toggleClass("fa-eye fa-eye-slash"),e.children("span").toggleClass("d-none")}),s}};return e.init()})}(jQuery),function(i){$resolver("manager.passwordDetailModal",function(s,t){var e={init:function(){var e=this;return e.passwordDetailModal=i("#password-detail-modal"),e.modalTitle=i("#password-detail-title"),e.txtLogin=i("#txtLogin"),e.txtPassword=i("#txtPassword"),i("#save-password").click(function(){t.savePassword()}),i("#add-password-detail").click(function(){t.addPasswordAdditionalDetail()}),e},show:function(){var e=this,t=s.getSelectedPassword();return e.passwordDetailModal.modal("show"),t.isNew&&e.modalTitle.text("Add New Password"),e.txtLogin.val(t.login),e.txtPassword.val(t.password),e},hide:function(){this.passwordDetailModal.modal("hide")},get:function(){return{login:this.txtLogin.val(),password:this.txtPassword.val()}}};return e.init()})}(jQuery),function(d){$resolver("manager.secretList",function(a,r){var o={init:function(){var e=this;return e.secretDownloadList=d("#secret-download-list tbody"),e.secretUploadList=d("#secret-upload-list tbody"),e.noRowMessageTml=_.template(d("#no-row-message-tml").html()),e.secretDownloadRowTml=_.template(d("#secret-download-row-tml").html()),e.secretUploadRowTml=_.template(d("#secret-upload-row-tml").html()),e},render:function(){var s="",e=a.getSecretList(),i=o.getSecretListRowTml(),t=o.getSecretListView();return this.secretDownloadList.parent().hide(),this.secretUploadList.parent().hide(),0===e.length?s="<tr class='no-data'><td colspan='4'>"+this.noRowMessageTml()+"</td></tr>":e.forEach((e,t)=>{e.confirmSecret="",s+=i({...e,index:t})}),t.html(s).parent().show(),d(".delete-secret").click(e=>{e=d(e.target).closest("tr");r.removeSecret(e.data("index"))}),t.find("input").change(e=>{o.validate()}),this},get:function(){var s=[];return o.getSecretListView().children("tr").each((e,t)=>{t=d(t);t.hasClass("no-data")||s.push({secret:t.find(".secret").val(),confirmSecret:t.find(".confirm-secret").val()})}),s},validate:function(){var i=!0,e=o.getSecretListView();return e===this.secretUploadList||e.children("tr").each((e,t)=>{var s,t=d(t);t.hasClass("no-data")?i=!1:(s=t.find(".secret"),t=t.find(".confirm-secret"),s.val()!=t.val()?(i=!1,s.addClass("is-invalid"),t.addClass("is-invalid")):(s.removeClass("is-invalid"),t.removeClass("is-invalid")))}),i},getSecretListView:function(){return"upload"==a.getSecretModalType()?this.secretUploadList:this.secretDownloadList},getSecretListRowTml:function(){return"upload"==a.getSecretModalType()?this.secretUploadRowTml:this.secretDownloadRowTml}};return o.init()})}(jQuery),function(i){$resolver("manager.secretModal",function(t,e){var s={init:function(){var t=this;return t.secretModal=i("#secret-modal"),t.passwordListFile=i("#passwordListFile"),t.passwordFilePanel=i(".password-file"),t.modalTitle=i("#secret-modal .modal-title"),t.proceedButtonIcon=i("#proceed .fa-solid"),t.fileReader=new FileReader,t.fileContentDefer=null,t.fileReader.onload=function(e){t.fileContentDefer.resolve(new Uint8Array(e.target.result))},t.fileReader.onerror=function(e){console.log("Error : "+e.type)},i("#proceed").click(function(){e.proceed()}),i("#add-secret").click(function(){e.addSecret()}),t},show:function(){var e=this;return"upload"==t.getSecretModalType()?(e.modalTitle.text("Upload"),e.passwordFilePanel.show(),e.proceedButtonIcon.removeClass("fa-lock").addClass("fa-unlock")):(e.modalTitle.text("Download"),e.passwordFilePanel.hide(),e.proceedButtonIcon.removeClass("fa-unlock").addClass("fa-lock")),e.secretModal.modal("show"),e},hide:function(){this.secretModal.modal("hide")},getAsync:async function(){var e=this;return e.fileContentDefer=i.Deferred(),0<e.passwordListFile[0].files.length?e.fileReader.readAsArrayBuffer(e.passwordListFile[0].files[0]):e.fileContentDefer.resolve(""),e.fileContentDefer},downloadFile:function(e){var t=document.getElementById("download-file");t.setAttribute("href",window.URL.createObjectURL(new Blob([e]))),t.click()},showAlert:function(){var e=i(".alert");e.toggleClass("d-none",!t.isError()),e.text(t.getErrorMessage())}};return s.init()})}(jQuery),function(i){$resolver("manager.tagList",function(s,e){var t={init:function(){return this.txtTags=i("#txtTags"),this.tagTml=_.template(i("#tag-tml").html()),i(".tags").click(function(){i("#txtTag").focus()}),i("#txtTag").keyup(function(e){13==e.which&&(t.get().includes(e.target.value)||t.addTag(e.target.value),e.target.value="")}),this},render:function(){var t=this,e=s.getTagList();return t.txtTags.find(".badge").remove(),e.forEach(e=>{t.addTag(e)}),t},addTag:function(e){e=i(this.tagTml({tag:e}));i("#txtTag").before(e),e.find(".delete").click(e=>{i(e.target).closest(".badge").remove()})},get:function(){var s=[];return this.txtTags.find(".badge").each((e,t)=>{s.push(i(t).text().trim())}),s}};return t.init()})}(jQuery),function(t){t("manager.model",function(){var e={},r=t("core.cryptoService");return e.init=function(){var e=this;return e.passwordListSource=[],e.passwordList=[],e.secretList=[],e.selectedPassword=null,e.selectedPasswordAdditionalDetails=null,e.secretModalType="",e.dirty=!1,e.error=!1,e.errorMessage="",e.searchIn="All",e.searchText="",e},e.getPasswordListSource=function(){return this.passwordListSource},e.getPasswordList=function(){return this.passwordList},e.addPassword=function(e,t,s){e.tags=t,e.additionalDetails=s,this.passwordListSource.push(e),this.dirty=!0},e.updatePassword=function(e,t,s){var i=this;i.selectedPassword.login=e.login,i.selectedPassword.password=e.password,i.selectedPassword.tags=t,i.selectedPassword.additionalDetails=s,i.dirty=!0},e.savePassword=function(e,t,s){this.selectedPassword.isNew?this.addPassword(e,t,s):this.updatePassword(e,t,s)},e.setSelectedPassword=function(e){this.selectedPassword=void 0!==e?this.passwordList[e]:{isNew:!0,login:"",password:"",tags:[],additionalDetails:[]},this.selectedPasswordAdditionalDetails=this.selectedPassword.additionalDetails},e.getSelectedPassword=function(){return this.selectedPassword},e.getSelectedPasswordAdditionalDetails=function(){return this.selectedPasswordAdditionalDetails},e.removePassword=function(t){var s=this,e=s.passwordListSource.findIndex(e=>e==s.passwordList[t]);s.passwordListSource.splice(e,1),s.dirty=!0},e.addPasswordAdditionalDetail=function(e){this.selectedPasswordAdditionalDetails=e,this.selectedPasswordAdditionalDetails.push({key:"",value:""})},e.removePasswordAdditionalDetail=function(e,t){this.selectedPasswordAdditionalDetails=e,this.selectedPasswordAdditionalDetails.splice(t,1)},e.cloneSecretList=function(){this.clonedSecretList=JSON.parse(JSON.stringify(this.secretList))},e.getSecretList=function(){return this.clonedSecretList},e.addSecret=function(e){this.clonedSecretList=e,this.clonedSecretList.push({secret:"",confirmSecret:""})},e.removeSecret=function(e,t){this.clonedSecretList=e,this.clonedSecretList.splice(t,1)},e.processPasswordList=async function(e,t){var s=this;s.error=!1,s.errorMessage="",s.secretList=t;try{for(var i=t.length-1;0<=i;i--)e=await r.decrypt(e,t[i].secret);s.passwordListSource=s.passwordList=JSON.parse(r.decode(e))}catch(e){s.error=!0,s.errorMessage=e}},e.encryptPasswordList=async function(e){var t=this,s=t.passwordListSource.map(e=>({login:e.login,password:e.password,tags:e.tags,additionalDetails:e.additionalDetails})),i=r.encode(JSON.stringify(s));t.error=!1,t.errorMessage="",t.secretList=e;try{for(var a=0;a<e.length;a++)i=await r.encrypt(i,e[a].secret);t.dirty=!1}catch(e){t.error=!0,t.errorMessage=e}return i},e.getTagList=function(){return this.selectedPassword.tags},e.addTag=function(e){0<this.selectedPassword.tags.indexOf(e)||(this.selectedPassword.tags.push(e),this.dirty=!0)},e.removeTag=function(e){e=this.selectedPassword.tags.indexOf(e);this.selectedPassword.tags.splice(e,1),this.dirty=!0},e.getSecretModalType=function(){return this.secretModalType},e.setSecretModalType=function(e){return this.secretModalType=e},e.isDirty=function(){return this.dirty},e.isError=function(){return this.error},e.getErrorMessage=function(){return this.errorMessage},e.setSearchContext=function(e,t){this.searchIn=e,this.searchText=t},e.searchPasswords=function(){var t,s=this;""==s.searchText?s.passwordList=s.passwordListSource:(t=new RegExp(s.searchText,"i"),s.passwordList=s.passwordListSource.filter(e=>"login"==s.searchIn?-1!=e.login.search(t):"password"==s.searchIn?-1!=e.password.search(t):"tags"==s.searchIn?e.tags.some(e=>-1!=e.search(t)):-1!=e.login.search(t)||-1!=e.password.search(t)||e.tags.some(e=>-1!=e.search(t))||e.additionalDetails.some(e=>-1!=e.key.search(t)||-1!=e.value.search(t))))},e.init()})}($resolver),function(e){e("manager.viewModel",class{model=e("manager.model");passwordDetailGridOperation=e("manager.passwordDetailGridOperation");passwordDetailListView=e("manager.passwordDetailGrid");secretModal=e("manager.secretModal");secretListView=e("manager.secretList");passwordDetailModal=e("manager.passwordDetailModal");additionalDetailView=e("manager.passwordDetail");tagListView=e("manager.tagList");constructor(e,t){this.model=this.model(),this.passwordDetailGridOperation=this.passwordDetailGridOperation(this.model,this),this.passwordDetailListView=this.passwordDetailListView(this.model,this),this.additionalDetailView=this.additionalDetailView(this.model,this),this.passwordDetailModal=this.passwordDetailModal(this.model,this),this.secretModal=this.secretModal(this.model,this),this.secretListView=this.secretListView(this.model,this),this.tagListView=this.tagListView(this.model,this),this.passwordDetailGridOperation.render(),this.passwordDetailListView.render()}showAddPassword=function(){this.model.setSelectedPassword(),this.passwordDetailModal.show(),this.additionalDetailView.render(),this.tagListView.render()};showEditPassword=function(e){this.model.setSelectedPassword(e),this.passwordDetailModal.show(),this.additionalDetailView.render(),this.tagListView.render()};savePassword=function(){var e=this.passwordDetailModal.get(),t=this.tagListView.get(),s=this.additionalDetailView.get();this.model.savePassword(e,t,s),this.passwordDetailModal.hide(),this.model.searchPasswords(),this.passwordDetailListView.render(),this.passwordDetailGridOperation.render()};deletePassword=function(e){this.model.removePassword(e),this.model.searchPasswords(),this.passwordDetailListView.render(),this.passwordDetailGridOperation.render()};addPasswordAdditionalDetail=function(){this.model.addPasswordAdditionalDetail(this.additionalDetailView.get()),this.additionalDetailView.render()};removePasswordAdditionalDetail=function(e){this.model.removePasswordAdditionalDetail(this.additionalDetailView.get(),e),this.additionalDetailView.render()};showSecretModal=function(e){this.model.setSecretModalType(e),this.model.cloneSecretList(),this.secretModal.show(),this.secretListView.render()};proceed=async function(){var e,t,s;this.secretListView.validate()&&(e=this.model.getSecretModalType(),t=this.secretListView.get(),"upload"==e?(s=await this.secretModal.getAsync(),await this.model.processPasswordList(s,t)):(s=await this.model.encryptPasswordList(t),this.secretModal.downloadFile(s)),this.secretModal.showAlert(),this.model.isError()||(this.secretModal.hide(),this.passwordDetailListView.render(),this.passwordDetailGridOperation.render()))};addSecret=function(){this.model.addSecret(this.secretListView.get()),this.secretListView.render(),this.secretListView.validate()};removeSecret=function(e){this.model.removeSecret(this.secretListView.get(),e),this.secretListView.render(),this.secretListView.validate()};searchPasswords=function(e,t){this.model.setSearchContext(e,t),this.model.searchPasswords(),this.passwordDetailListView.render()}})}((jQuery,window,$resolver)),function(e,t){var s={},i="manager";s.manager={url:"#/",templateUrl:"manager/index.html",viewModel:t("manager.viewModel")},s.learn={url:"#/learn",templateUrl:"learn/index.html"},e.router.setData(s).setDefault(i).onRouteChanged(function(e,t,s){t.viewModel&&new t.viewModel(t,s)}),e.when(e.ready).then(function(){e.router.run(".my-view",i)})}(jQuery,$resolver);